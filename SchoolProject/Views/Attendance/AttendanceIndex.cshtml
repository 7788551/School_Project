@{
    ViewData["Title"] = "AttendanceIndex";
    Layout = "~/Views/Shared/TeacherLayout.cshtml";
}

<main class="main-content">

    <h3 class="mb-3">📝 Mark Attendance</h3>

    <!-- Class Info -->
    <div class="alert alert-info">
        <strong>Class:</strong> @ViewBag.ClassName <br />
        <strong>Section:</strong> @ViewBag.SectionName <br />
        <strong>Date:</strong> @ViewBag.Today
    </div>

    <form method="post" asp-action="MarkAttendance">

        <!-- Same day attendance -->
        <input type="hidden"
               name="attendanceDate"
               value="@DateTime.Today.ToString("yyyy-MM-dd")" />

        <!-- Responsive Table -->
        <div class="table-responsive">
            <table class="table table-bordered align-middle text-center">
                <thead class="table-dark">
                    <tr>
                        <th style="width:50%">Student Name</th>
                        <th style="width:25%">Present</th>
                        <th style="width:25%">Absent</th>
                    </tr>
                </thead>
                <tbody id="studentRows">
                    <!-- Rows loaded via JS -->
                </tbody>
            </table>
        </div>

        <div class="text-end mt-3">
            <button type="submit" class="btn btn-success px-4">
                💾 Save Attendance
            </button>
        </div>

    </form>

    <!-- Alerts -->
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success mt-3">
            @TempData["Success"]
        </div>
    }

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger mt-3">
            @TempData["Error"]
        </div>
    }

</main>

@section Scripts {
    <script>
        fetch('/Attendance/LoadStudents')
            .then(res => res.json())
            .then(data => {

                const tbody = document.getElementById('studentRows');

                if (!data || data.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="3" class="text-center text-muted">
                                No students found for your assigned class.
                            </td>
                        </tr>`;
                    return;
                }

                let rows = '';

                data.forEach((student, index) => {
                    rows += `
                    <tr>
                        <td class="text-start">
                            ${student.studentName}
                            <input type="hidden"
                                   name="model[${index}].StudentId"
                                   value="${student.studentId}" />
                        </td>

                        <!-- Present (default selected) -->
                        <td>
                            <input type="radio"
                                   name="model[${index}].IsPresent"
                                   value="true"
                                   class="form-check-input present-radio"
                                   checked />
                        </td>

                        <!-- Absent -->
                        <td>
                            <input type="radio"
                                   name="model[${index}].IsPresent"
                                   value="false"
                                   class="form-check-input absent-radio" />
                        </td>
                    </tr>`;
                });

                tbody.innerHTML = rows;
            })
            .catch(() => {
                document.getElementById('studentRows').innerHTML = `
                    <tr>
                        <td colspan="3" class="text-danger text-center">
                            Failed to load students.
                        </td>
                    </tr>`;
            });
    </script>

    <style>
        .present-radio {
            transform: scale(1.2);
            accent-color: #198754; /* green */
        }

        .absent-radio {
            transform: scale(1.2);
            accent-color: #dc3545; /* red */
        }
    </style>
}
